---

title: TopEx

keywords: fastai
sidebar: home_sidebar

summary: "Topic exploration in unstructured text documents."
description: "Topic exploration in unstructured text documents."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Requirements">Requirements<a class="anchor-link" href="#Requirements"> </a></h2><p>TopEx is only compatible with 64-bit python. You can check which version of python you're using in your virtual environment with the following code.</p>
<p><code>import platform; platform.architecture()[0];</code></p>
<p><code>pip install topex</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A template pipeline is provided below using a test dataset. You can read more about the test_data dataset <a href="https://github.com/VCUWrightCenter/TopEx/tree/master/test_data/README.md">here</a></p>
<p>Each step of the pipeline has configuration options for experimenting with various methods. These are detailed in the documentation for each method. Notably, the <code>import_docs</code>, <a href="/TopEx/core#get_cluster_topics"><code>get_cluster_topics</code></a>, <a href="/TopEx/core#visualize_clustering"><code>visualize_clustering</code></a>, and <a href="/TopEx/core#evaluate"><code>evaluate</code></a> methods all include the option to save results to a file.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example-Pipeline">Example Pipeline<a class="anchor-link" href="#Example-Pipeline"> </a></h2><h3 id="Import-data">Import data<a class="anchor-link" href="#Import-data"> </a></h3><p>Import and pre-process documents from a text file containing a list of all documents.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">topex.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">data</span><span class="p">,</span> <span class="n">doc_df</span> <span class="o">=</span> <span class="n">import_from_files</span><span class="p">(</span><span class="s1">&#39;test_data/corpus_file_list.txt&#39;</span><span class="p">,</span> <span class="n">stop_words_file</span><span class="o">=</span><span class="s1">&#39;stop_words.txt&#39;</span><span class="p">,</span> <span class="n">save_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also consolidate your documents into a single, pipe-delimited csv file with the columns "doc_name" and "text".</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="p">,</span> <span class="n">doc_df</span> <span class="o">=</span> <span class="n">import_from_csv</span><span class="p">(</span><span class="s1">&#39;test_data/corpus.txt&#39;</span><span class="p">,</span> <span class="n">stop_words_file</span><span class="o">=</span><span class="s1">&#39;stop_words.txt&#39;</span><span class="p">,</span> <span class="n">save_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transform-data">Transform data<a class="anchor-link" href="#Transform-data"> </a></h3><p>Create word vectors from the most expressive phrase in each sentence of the imported documents. Seed documents can be passed as a single CSV similar to corpus documents in the import step.</p>
<p>NOTE: If <code>doc_df</code> is NOT passed to <a href="/TopEx/core#create_tfidf"><code>create_tfidf</code></a>, you must set <code>include_input_in_tfidf=False</code> in <a href="/TopEx/core#get_phrases"><code>get_phrases</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfidf</span><span class="p">,</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="n">create_tfidf</span><span class="p">(</span><span class="n">doc_df</span><span class="p">,</span> <span class="n">path_to_seed_topics_file_list</span><span class="o">=</span><span class="s1">&#39;test_data/seed_topics_file_list.txt&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">get_phrases</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">token2id</span><span class="p">,</span> <span class="n">tfidf</span><span class="p">,</span> <span class="n">include_input_in_tfidf</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">include_sentiment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">get_vectors</span><span class="p">(</span><span class="s2">&quot;tfidf&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">tfidf</span> <span class="o">=</span> <span class="n">tfidf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Removed 67 sentences without phrases.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Cluster-data">Cluster data<a class="anchor-link" href="#Cluster-data"> </a></h3><p>Cluster the sentences into groups expressing similar ideas or topics. If you aren't sure how many true clusters exist in the data, try running <a href="/TopEx/core#assign_clusters"><code>assign_clusters</code></a> with the optional parameter <code>show_chart = True</code> to visual cluster quality with varying numbers of clusters. When using <code>method='hac'</code>, you can also use <code>show_dendrogram = True</code> see the cluster dendrogram.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">assign_clusters</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;hac&quot;</span><span class="p">)</span>
<span class="n">cluster_df</span> <span class="o">=</span> <span class="n">get_cluster_topics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">doc_df</span><span class="p">,</span> <span class="n">save_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">visualize_clustering</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;umap&quot;</span><span class="p">,</span> <span class="n">show_chart</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Evaluate-results">Evaluate results<a class="anchor-link" href="#Evaluate-results"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gold_file</span> <span class="o">=</span> <span class="s2">&quot;test_data/gold.txt&quot;</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gold_file</span><span class="o">=</span><span class="s2">&quot;test_data/gold.txt&quot;</span><span class="p">,</span> <span class="n">save_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Document-Clustering">Document Clustering<a class="anchor-link" href="#Document-Clustering"> </a></h2><p><strong>IMPORTANT</strong>: This feature is still in alpha, meaning that we have adapted the pipeline to accomodate the clustering of documents, but have made no rigorous efforts the ensure that it works well.</p>
<p>To cluster documents, simply import data and create the TF-IDF as above, but extract phrase, create the vectors, and cluster using the <code>doc_df</code> dataframe. Passing the parameter <code>window_size=-1</code> to <a href="/TopEx/core#get_phrases"><code>get_phrases</code></a> tells the method to use all tokens instead of selecting a subset of length <code>window_size</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">doc_df</span> <span class="o">=</span> <span class="n">get_phrases</span><span class="p">(</span><span class="n">doc_df</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">token2id</span><span class="p">,</span> <span class="n">tfidf</span><span class="p">,</span> <span class="n">include_input_in_tfidf</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">doc_df</span> <span class="o">=</span> <span class="n">get_vectors</span><span class="p">(</span><span class="s2">&quot;tfidf&quot;</span><span class="p">,</span> <span class="n">doc_df</span><span class="p">,</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">tfidf</span> <span class="o">=</span> <span class="n">tfidf</span><span class="p">)</span>
<span class="n">doc_df</span> <span class="o">=</span> <span class="n">assign_clusters</span><span class="p">(</span><span class="n">doc_df</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;kmeans&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">cluster_df</span> <span class="o">=</span> <span class="n">get_cluster_topics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">doc_df</span><span class="p">,</span> <span class="n">save_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">visualize_clustering</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;umap&quot;</span><span class="p">,</span> <span class="n">show_chart</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Removed 0 sentences without phrases.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

