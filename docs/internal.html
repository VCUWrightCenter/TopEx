---

title: Internal

keywords: fastai
sidebar: home_sidebar

summary: "Internal MedTop methods"
description: "Internal MedTop methods"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: internal.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These methods are intended for internal use only. MedTop users should only need to import the core module in order to fully use every feature of the MedTop library.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-processing">Data processing<a class="anchor-link" href="#Data-processing"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_phrase" class="doc_header"><code>get_phrase</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_phrase</code>(<strong><code>sent</code></strong>:<code>Series</code>, <strong><code>window_size</code></strong>:<code>int</code>, <strong><code>feature_names</code></strong>:<code>dict</code>, <strong><code>include_input_in_tfidf</code></strong>:<code>bool</code>, <strong><code>tdm</code></strong>:<code>ndarray</code>, <strong><code>token_averages</code></strong>:<code>ndarray</code>)</p>
</blockquote>
<p>Finds the most expressive phrase in a sentence. This function is called in a lambda expression in <code>core.get_phrases</code>.</p>
<p>Returns list</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_vector_tfidf" class="doc_header"><code>get_vector_tfidf</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L69" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_vector_tfidf</code>(<strong><code>sent</code></strong>:<code>Series</code>, <strong><code>dictionary</code></strong>:<code>Dictionary</code>, <strong><code>term_matrix</code></strong>:<code>ndarray</code>)</p>
</blockquote>
<p>Create a word vector for a given sentence using a term matrix.
This function is called in a lambda expression in <code>core.get_vectors</code>.</p>
<p>Returns list</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_vector_w2v" class="doc_header"><code>get_vector_w2v</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L79" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_vector_w2v</code>(<strong><code>sent</code></strong>:<code>Series</code>, <strong><code>model</code></strong>:<code>Word2VecKeyedVectors</code>)</p>
</blockquote>
<p>Create a word vector for a given sentence using a Word2Vec model.
This function is called in a lambda expression in <code>core.get_vectors</code>.</p>
<p>Returns list</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="w2v_pretrained" class="doc_header"><code>w2v_pretrained</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L90" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>w2v_pretrained</code>(<strong><code>bin_file</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Load a pre-trained Word2Vec model from a bin file.</p>
<p>Returns gensim.models.keyedvectors.Word2VecKeyedVectors</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">medtop.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">data</span><span class="p">,</span> <span class="n">doc_df</span> <span class="o">=</span> <span class="n">import_docs</span><span class="p">(</span><span class="s1">&#39;test_data/corpus_file_list.txt&#39;</span><span class="p">,</span> <span class="n">save_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">tfidf</span><span class="p">,</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="n">create_tfidf</span><span class="p">(</span><span class="s1">&#39;test_data/seed_topics_file_list.txt&#39;</span><span class="p">,</span> <span class="n">doc_df</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">get_phrases</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">token2id</span><span class="p">,</span> <span class="n">tfidf</span><span class="p">,</span> <span class="n">include_input_in_tfidf</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">get_vectors</span><span class="p">(</span><span class="s2">&quot;tfidf&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">tfidf</span> <span class="o">=</span> <span class="n">tfidf</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">assign_clusters</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;kmeans&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">cluster_df</span> <span class="o">=</span> <span class="n">get_cluster_topics</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">doc_df</span><span class="p">,</span> <span class="n">save_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Removed 43 sentences without phrases.
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">linkage_matrix</span> <span class="o">=</span> <span class="n">get_linkage_matrix</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">vec</span><span class="p">),</span> <span class="s2">&quot;cosine&quot;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="o">.</span><span class="n">to_tree</span><span class="p">(</span><span class="n">linkage_matrix</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>scipy.cluster.hierarchy.ClusterNode</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clustering">Clustering<a class="anchor-link" href="#Clustering"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_silhouette_score_hac" class="doc_header"><code>get_silhouette_score_hac</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_silhouette_score_hac</code>(<strong><code>phrase_vecs</code></strong>:<code>list</code>, <strong><code>linkage_matrix</code></strong>:<code>ndarray</code>, <strong><code>height</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Assigns clusters to a list of word vectors for a given <code>height</code> and calculates the silhouette score of the clustering.</p>
<p>Returns float</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_tree_height" class="doc_header"><code>get_tree_height</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L108" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_tree_height</code>(<strong><code>root</code></strong>:<code>ClusterNode</code>)</p>
</blockquote>
<p>Gets the height of a binary tree.</p>
<p>Returns int</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_linkage_matrix" class="doc_header"><code>get_linkage_matrix</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L118" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_linkage_matrix</code>(<strong><code>phrase_vecs</code></strong>:<code>list</code>, <strong><code>dist_metric</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Creates a linkage matrix by calculating distance between phrase vectors.</p>
<p>Returns np.ndarray</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_optimal_height" class="doc_header"><code>get_optimal_height</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L130" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_optimal_height</code>(<strong><code>data</code></strong>:<code>DataFrame</code>, <strong><code>linkage_matrix</code></strong>:<code>ndarray</code>, <strong><code>show_dendrogram</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>show_chart</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>save_chart</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>chart_file</code></strong>:<code>str</code>=<em><code>'HACSilhouette.png'</code></em>)</p>
</blockquote>
<p>Clusters the top phrase vectors and plots the silhoute coefficients for a range of dendrograph heights.
Returns the optimal height value (highest silhoute coefficient)</p>
<p>Returns int</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_clusters_hac" class="doc_header"><code>get_clusters_hac</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_clusters_hac</code>(<strong><code>data</code></strong>:<code>DataFrame</code>, <strong><code>dist_metric</code></strong>:<code>str</code>, <strong><code>height</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>show_dendrogram</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>show_chart</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Use Hierarchical Agglomerative Clustering (HAC) to cluster phrase vectors</p>
<p>Returns list</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_silhouette_score_kmeans" class="doc_header"><code>get_silhouette_score_kmeans</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L179" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_silhouette_score_kmeans</code>(<strong><code>phrase_vecs</code></strong>:<code>list</code>, <strong><code>k</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Assigns clusters to a list of word vectors for a given <code>k</code> and calculates the silhouette score of the clustering.</p>
<p>Returns float</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_optimal_k" class="doc_header"><code>get_optimal_k</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L188" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_optimal_k</code>(<strong><code>data</code></strong>:<code>DataFrame</code>, <strong><code>show_chart</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>save_chart</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>chart_file</code></strong>:<code>str</code>=<em><code>'KmeansSilhouette.png'</code></em>)</p>
</blockquote>
<p>Calculates the optimal k-value (highest silhoute coefficient).
Optionally prints a chart of silhouette score by k-value or saves it to disk.</p>
<p>Returns int</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_clusters_kmeans" class="doc_header"><code>get_clusters_kmeans</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L213" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_clusters_kmeans</code>(<strong><code>data</code></strong>:<code>DataFrame</code>, <strong><code>k</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>show_chart</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Use K-means algorithm to cluster phrase vectors</p>
<p>Returns list</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Export">Export<a class="anchor-link" href="#Export"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="df_to_disk" class="doc_header"><code>df_to_disk</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L232" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>df_to_disk</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>file_name</code></strong>:<code>str</code>, <strong><code>mode</code></strong>:<code>str</code>=<em><code>'w'</code></em>, <strong><code>header</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Writes a dataframe to disk as a tab delimited file.</p>
<p>Returns None</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sentences_to_disk" class="doc_header"><code>sentences_to_disk</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L242" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sentences_to_disk</code>(<strong><code>data</code></strong>:<code>DataFrame</code>, <strong><code>file_name</code></strong>:<code>str</code>=<em><code>'output/DocumentSentenceList.txt'</code></em>)</p>
</blockquote>
<p>Writes the raw sentences to a file organized by document and sentence number.</p>
<p>Returns None</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="write_cluster" class="doc_header"><code>write_cluster</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L252" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>write_cluster</code>(<strong><code>cluster_rows</code></strong>:<code>DataFrame</code>, <strong><code>file_name</code></strong>:<code>str</code>, <strong><code>mode</code></strong>:<code>str</code>=<em><code>'a'</code></em>, <strong><code>header</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Appends the rows for a single cluster to disk.</p>
<p>Returns None</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clusters_to_disk" class="doc_header"><code>clusters_to_disk</code><a href="https://github.com/etfrenchvcu/medtop/tree/master/medtop/internal.py#L261" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clusters_to_disk</code>(<strong><code>data</code></strong>:<code>DataFrame</code>, <strong><code>doc_df</code></strong>:<code>DataFrame</code>, <strong><code>cluster_df</code></strong>:<code>DataFrame</code>, <strong><code>file_name</code></strong>:<code>str</code>=<em><code>'output/TopicClusterResults.txt'</code></em>)</p>
</blockquote>
<p>Writes the sentences and phrases to a file organized by cluster and document.</p>
<p>Returns None</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

